# アンケート画像解析ツール

スキャンされたアンケート用紙の画像を解析し、チェックボックスの選択状態や自由記述欄の記入有無を判定して、結果を CSV ファイルに出力するためのツール群です。

## スクリーンショット

### 座標設定ツール（coordinate_setter.py）

![座標設定ツール](images/Screenshot%200007-09-28%20at%200.03.57.png)

### 解析結果の確認

![解析結果](images/Screenshot%200007-09-28%20at%200.04.31.png)

## ファイル構成

- **`main.py`**:
  アンケート画像を実際に解析し、`results.csv`を生成するメインスクリプトです。Jupyter Notebook や Google Colaboratory のような、セル単位での実行を想定した構成になっています。

- **`coordinate_setter.py`**:
  `main.py`で使用する設定コード（`CONFIG`）を、GUI 上で簡単に作成するためのデスクトップアプリケーションです。

---

## セットアップ

このツールは、ライブラリの依存関係を管理するために`Conda`仮想環境で実行することを強く推奨します。

1.  **Conda 仮想環境の作成**
    ターミナルで以下のコマンドを実行し、`survey-tool`という名前の仮想環境を作成します。このコマンドで、実行に必要なライブラリもすべて同時にインストールされます。

    ```bash
    conda create -n survey-tool python=3.11 tk pillow pandas opencv-python japanize-matplotlib
    ```

    _(途中で `Proceed ([y]/n)?` と聞かれたら `y` を入力して Enter を押してください)_

2.  **仮想環境のアクティベート**
    作成した環境を有効にします。このプロジェクトを使用する際は、必ずこのコマンドを実行してください。

    ```bash
    conda activate survey-tool
    ```

    ターミナルの行頭に`(survey-tool)`と表示されれば成功です。

---

## 使用手順（ワークフロー）

### Step 1: `coordinate_setter.py` で座標を設定する

まず、解析したいアンケートの「どこに」「何があるか」を定義する設定ファイルを作成します。

1.  上記の手順で Conda 環境を有効化します。

2.  ターミナルでこのプロジェクトのディレクトリに移動します。

    ```bash
    cd /path/to/アンケート解析
    ```

3.  以下のコマンドで、設定ツールを起動します。

    ```bash
    python coordinate_setter.py
    ```

4.  アプリが起動したら、以下の操作で座標を設定します。

    - **画像を開く**: 「画像ファイルを開く」ボタンを押し、見本となるアンケートのスキャン画像を 1 枚開きます。
    - **モード選択**: 「チェックボックス」か「自由記述欄」か、作成したい領域の種類を選びます。
    - **領域作成**: 画像の上をドラッグ＆ドロップして、四角い領域を作成します。
    - **ラベル入力**: 領域を作成すると名前の入力ウィンドウが開くので、`Q1_選択肢1`や`感想`のような、CSV の列名として分かりやすい名前を入力します。
    - **調整**:
      - **移動**: 作成した枠は、ドラッグ＆ドロップで位置を微調整できます。
      - **複製**: 右のリストで項目を選び「複製」ボタンを押すと、同じ大きさの枠をコピーできます。
      - **名前変更**: 右のリストの項目をダブルクリックすると、名前を再編集できます。
      - **削除**: 右のリストで項目を選び「削除」ボタンで消せます。
      - **表示操作**: `Shift`+ドラッグで画像全体を移動、マウスホイールで拡大・縮小ができます。

5.  すべての領域を設定し終えたら、「設定コードを生成」ボタンを押します。

6.  下に表示されたテキストボックス内の`CONFIG = { ... }`のコード全体をコピーします。

### Step 2: `main.py` に設定を反映する

次に、生成した設定コードを解析スクリプトに組み込みます。

1.  エディタで`main.py`ファイルを開きます。

2.  ファイルの上部にある`CONFIG = { ... }`のブロック全体を、先ほどコピーしたコードで完全に置き換えます。

3.  必要に応じて、各チェックボックスや自由記述欄の`"threshold"`（閾値）の値を手動で微調整します。この値は、デバッグモードで表示される「黒ピクセル率」を参考に決定するのがおすすめです。

### Step 3: `main.py` で解析を実行する

最後に、設定を反映したスクリプトで、実際の解析を行います。

1.  プロジェクト内に`images`という名前のフォルダを作成し、その中に解析したいアンケート画像をすべて入れます。

2.  `main.py`の末尾にある「メイン処理フロー」のセクションのコメントアウト（`#`）を、目的に合わせて解除します。

    - **`②`**: グリッド表示（現在は不要）
    - **`③`**: 設定した枠の位置をプレビューで確認
    - **`④`**: 1 枚ずつ解析結果を画像つきで確認（デバッグ用）
    - **`⑤`**: 全画像を解析して CSV を生成（本番）

3.  Jupyter Notebook や Google Colab、またはターミナルで`python main.py`のようにしてスクリプトを実行します。
    _(Colab で実行する場合は、ファイルのアップロード方法などを適宜変更してください)_

4.  実行が完了すると、プロジェクトのルートに`results.csv`が生成されます。また、自由記述があった画像は`free_texts`フォルダにコピーされます。
